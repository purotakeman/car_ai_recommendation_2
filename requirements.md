# AI自動車推薦システム 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
AI自動車診断システム（Car AI Recommendation System）

### 1.2 目的
自動車の知識がないユーザーでも、簡単に最適なクルマを見つけられるWebアプリケーションを提供する。ユーザーの希望（ボディタイプ、駆動方式、価格など）に基づき、AI的なロジックで車を推薦・フィルタリングする。

### 1.3 対象ユーザー
- 自動車購入を検討している一般ユーザー
- 自動車の知識が少ない初心者
- 複数の条件から最適な車を探したいユーザー
- ライフスタイルに合った車を探したいユーザー

### 1.4 技術スタック
- **バックエンド**: Python 3.9+, Flask 2.3.3
- **データ処理**: Pandas 2.0.3, NumPy
- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **データ形式**: CSV（将来はSQLite/PostgreSQL移行予定）
- **API**: RESTful API（JSON形式）
---

## 2. 機能要件

### 2.1 車両検索・推薦機能

#### 2.1.1 ハイブリッド診断機能（スマート診断）
**優先度**: 高

**機能概要**:
段階的な質問形式でユーザーのニーズを把握し、最適な車両を推薦する。

**詳細要件**:
- **ステップ1: 基本情報（事実情報）**
  - 主な用途（家族での外出、通勤・通学、レジャー・趣味、仕事・営業）
  - 予算帯（〜200万円、200〜400万円、400〜600万円、600万円～）
  - 普段の乗車人数（1〜2人、3〜4人、5人以上）
  - 選択肢形式（ラジオボタン）で回答

- **ステップ2: 重視ポイント（嗜好情報）**
  - 燃費の良さ（5段階評価）
  - 安全性（5段階評価）
  - デザインの良さ（5段階評価）
  - 広い室内空間（5段階評価）
  - 維持費の安さ（5段階評価）

- **ステップ3: 診断結果表示**
  - ユーザープロファイルの判定（ファミリー重視、通勤・実用重視、高級・品質重視、エコ・環境重視、バランス重視）
  - プロファイル説明と推薦理由の表示
  - 推薦車両の表示
    →おすすめ順で表示

**技術要件**:
- プログレスバーによる進捗表示
- ステップ間の前後移動機能
- 入力バリデーション（全項目必須）
- AJAXによる非同期推薦処理

#### 2.1.2 詳細検索機能
**優先度**: 高

**機能概要**:
従来のフィルタリング形式で、詳細な条件を指定して車両を検索する。

**詳細要件**:
- **フィルタリング条件**:
  - ボディタイプ（複数選択可）: SUV、セダン、ハッチバック、ミニバン、軽自動車、オープンカー、クーペ、ハイトワゴン、バン/トラック、ワゴン
  - 駆動方式（複数選択可）: 2WD、4WD、2WD(MT)、4WD(MT)、4WD(4MT)、4WD(5MT)
  - 燃料タイプ（複数選択可）: レギュラー、ハイオク、ディーゼル、水素、電気(BEV)、レギュラー(HEV)、レギュラー(PHEV)、ハイオク(HEV)、ハイオク(PHEV)、ディーゼル(HEV)
  - 上限価格（万円）: 50〜2000万円
  - 燃費下限（km/L）: 5〜40km/L
    →燃料タイプで水素が表示された場合は、水素燃費
  - 乗車定員下限（人）: 2〜15人

- **検索結果表示**:
  - 推薦スコア順にソート
  - 車両カード形式で一覧表示
  - 並び替え機能（推薦順、価格順、燃費順）

#### 2.1.3 推薦スコア計算機能
**優先度**: 高

**機能概要**:
ユーザーの嗜好に基づいて、各車両の推薦スコア（0-100点）を計算する。

**詳細要件**:
- **評価項目**:
  - 価格スコア（0-100）
  - 燃費スコア（0-100）
  - サイズ適合度スコア（0-100）
  - 安全性スコア（0-100）
  - 維持費スコア（0-100）
  - ブランド信頼性スコア（0-100）
  - 環境性能スコア（0-100）
  - 用途適合度スコア（0-100）

- **ユーザープロファイル別の重み付け**:
  - ファミリー向け: 安全性25%、室内空間20%、燃費20%、価格15%、信頼性10%
  - 通勤向け: 燃費30%、価格25%、維持費20%、サイズ15%、信頼性10%
  - 高級志向: 快適性25%、性能20%、ブランド20%、安全性15%、デザイン20%
  - エコ志向: 燃費35%、環境性能25%、価格20%、維持費20%
  - スポーツ志向: 性能30%、デザイン25%、ハンドリング20%、ブランド15%、個性10%

- **推薦理由の自動生成**:
  - 高得点要因に基づく推薦理由を3つまで生成

**技術要件**:
- 動的重み付けによるスコア計算
- プロファイル自動判定機能
- エラーハンドリング（データ欠損時のデフォルト値設定）

### 2.2 車両情報表示機能

#### 2.2.1 車両一覧表示
**優先度**: 高

**詳細要件**:
- 車両カード形式での表示
- 表示項目: メーカー、車種、自動車タイプ、ボディタイプ、駆動方式、価格帯、排気量、最新モデル、グレード、燃費(km/L)電費(Wh/km)水素燃費(km/kg)、燃料の種類、乗車定員、中古相場、（推薦スコア、推薦理由）
- レスポンシブデザイン対応
- お気に入りボタン
- 詳細ページへのリンク

#### 2.2.2 車両詳細表示
**優先度**: 高

**詳細要件**:
- 車両の詳細情報表示
- 関連車両の表示（同じボディタイプまたはメーカーの車、最大5台）
- 維持費シミュレーション（将来実装予定）
- YouTubeレビュー動画、レビューサイトへの誘導(API等連携)

#### 2.2.3 車両比較機能
**優先度**: 中

**詳細要件**:
- 複数車両の並列比較表示
- 比較項目: 価格、燃費、安全性、維持費、ブランド、環境性能、乗車定員

### 2.3 ユーザー機能

#### 2.3.1 お気に入り機能
**優先度**: 中

**詳細要件**:
- ローカルストレージ（localStorage）によるお気に入り保存
- お気に入り一覧ページの表示
- お気に入りの追加・削除機能

**技術要件**:
- ブラウザのローカルストレージを使用
- セッション間でのデータ保持

#### 2.3.2 ユーザーアカウント管理（将来実装）
**優先度**: 低

**詳細要件**:
- ユーザー登録・ログイン機能
- お気に入りのサーバー側保存
- 検索履歴の保存

### 2.4 API機能

#### 2.4.1 RESTful API
**優先度**: 高

**エンドポイント**:
- `GET /api/cars`: 全車両データ取得（フィルタリング対応）
  - クエリパラメータ: `maker`, `body_type`, `max_price`
- `GET /api/cars/<id>`: 特定車両データ取得
- `POST /api/recommend`: 推薦API（AJAX用）
  - リクエストボディ: ユーザー嗜好情報（JSON形式）
  - レスポンス: 推薦車両リスト、ユーザープロファイル、診断タイプ

**技術要件**:
- JSON形式でのデータ交換
- エラーハンドリング（404、500エラー対応）
- CORS対応（必要に応じて）

### 2.5 UI/UX機能

#### 2.5.1 レスポンシブデザイン
**優先度**: 高

**詳細要件**:
- PC、タブレット、スマートフォン対応
- 画面サイズに応じたレイアウト調整

#### 2.5.2 ローディング表示
**優先度**: 中

**詳細要件**:
- 推薦処理中のローディングアニメーション
- 非同期処理の視覚的フィードバック

#### 2.5.3 通知システム
**優先度**: 中

**詳細要件**:
- 成功・エラー・警告・情報の通知表示
- 自動非表示機能（5秒後）

#### 2.5.4 モード切り替え
**優先度**: 中

**詳細要件**:
- ハイブリッド診断モードと詳細検索モードの切り替え
- セッションストレージによるモード状態の保持

---

## 3. 非機能要件

### 3.1 パフォーマンス要件
- 検索結果の表示: 1秒以内
- API応答時間: 500ms以内
- ページ読み込み時間: 3秒以内

### 3.2 可用性要件
- エラーハンドリング: 適切なエラーメッセージ表示
- 404エラーページ、500エラーページの実装
- データ欠損時のデフォルト値設定

### 3.3 セキュリティ要件
- 入力値のサニタイゼーション
- XSS対策
- CSRF対策（将来実装）

### 3.4 保守性要件
- コードの可読性とコメント
- モジュール化された設計
- エラーログの記録

### 3.5 互換性要件
- 主要ブラウザ対応（Chrome、Firefox、Safari、Edge）
- 文字エンコーディング: UTF-8対応
- Windows、macOS、Linux対応

---

## 4. データ要件

### 4.1 車両データ構造
メーカー、車種、自動車タイプ、ボディタイプ、駆動方式、価格帯、排気量、最新モデル、グレード、先進安全装備、燃費(km/L)電費(Wh/km)水素燃費(km/kg)、燃料の種類、自動車税、乗車定員、中古相場、サイズ
**必須項目**:
- `id`: 車両ID（一意）
- `メーカー`: メーカー名
- `車種`: 車種名
- `自動車タイプ`: 普通車/軽自動車
- `ボディタイプ`: SUV、セダン、ハッチバック、ミニバン、軽自動車、オープンカー、クーペ、ハイトワゴン、バン/トラック、ワゴン
- `駆動方式`: 2WD、4WD、2WD(MT)、4WD(MT)、4WD(4MT)、4WD(5MT)
- `価格帯(万円)`: 価格範囲（例: "220~280"）
- `排気量`: 排気量（cc）
- `最新モデル`: 直近の主要諸元表更新時期(一部改良、モデルチェンジ、マイナーチェンジ等による変更)
- `グレード・モデル`: グレード名・モデル名
- `先進安全装備`: 各メーカー標準安全装備名
- `燃費(km/L)電費(Wh/km)水素燃費(km/kg)`: 燃費、電費
- `燃料の種類`: レギュラー、ハイオク、ディーゼル、水素、電気(BEV)、レギュラー(HEV)、レギュラー(PHEV)、ハイオク(HEV)、ハイオク(PHEV)、ディーゼル(HEV)
- `自動車税(円)`: 年間自動車税
- `乗車定員`: 乗車定員数
- `中古相場(万円)`: 中古相場価格
- `サイズ(mm)`: 車体サイズ

**データ形式**:
- CSV形式（現在）
- 将来はSQLite/PostgreSQL移行予定

### 4.2 データ品質要件
- データ欠損時のデフォルト値設定
- 数値データの型変換とバリデーション
- 文字エンコーディング対応（UTF-8、Shift-JIS、CP932）

---

## 5. システム構成

### 5.1 ディレクトリ構造
```
car_ai_recommendation/
├── app.py                    # メインのFlaskアプリ
├── requirements.txt          # 依存パッケージリスト
├── README.md                 # プロジェクト説明
├── requirements.md           # 要件定義書（本ドキュメント）
├── FUNCTIONAL_SPEC.md        # 機能仕様書
│
├── /templates/               # HTMLテンプレート
│   ├── index.html            # メインページ
│   ├── car_detail.html       # 車両詳細ページ
│   ├── car_compare.html      # 車両比較ページ
│   ├── favorites.html        # お気に入りページ
│   ├── 404.html              # 404エラーページ
│   └── 500.html              # 500エラーページ
│
├── /static/                  # 静的ファイル
│   ├── /css/                 # CSSファイル
│   │   ├── style.css         # メインスタイル
│   │   ├── detail.css        # 詳細ページスタイル
│   │   ├── enhanced.css      # 拡張機能スタイル
│   │   └── hybrid.css        # ハイブリッド診断スタイル
│   ├── /js/                  # JavaScriptファイル
│   │   ├── script.js         # メイン機能
│   │   ├── detail.js         # 詳細ページ機能
│   │   ├── enhanced.js       # 拡張機能
│   │   └── hybrid.js          # ハイブリッド診断機能
│   └── /images/              # 画像ファイル
│
├── /data/                    # データ関連ファイル
│   └── car_data_base.csv     # 車両データCSV
│
└─── /utils/                   # ユーティリティ関数
    ├── filters.py            # フィルタリング関数
    └── recommendation.py     # 推薦ロジック
```

### 5.2 主要モジュール

#### 5.2.1 app.py
- Flaskアプリケーションのメイン
- ルーティング定義
- APIエンドポイント実装
- エラーハンドリング

#### 5.2.2 utils/recommendation.py
- 推薦スコア計算エンジン
- ユーザープロファイル判定
- 詳細スコア計算
- 推薦理由生成

#### 5.2.3 static/js/hybrid.js
- ハイブリッド診断のUI制御
- ステップ管理
- プロファイル分析
- API連携

---

## 6. 制約事項・既知の制限

### 6.1 現在の制約
- 車両データcsvにあるデータは開発者による手動入力
- 車両データは固定（CSVファイルから読み込み）
- ユーザー認証機能未実装
- 画像データなし
- 実際の中古車価格とのリアルタイム連携なし
- データベース未使用（CSVファイルのみ）

### 6.2 将来の改善予定
- SQLite/PostgreSQLへの移行
- 機械学習による推薦精度向上
- 外部API連携（リアルタイム価格情報）
- ユーザーアカウント管理
- 画像表示機能
- レビュー・コミュニティ機能
  →YouTubeレビュー動画統合

---

## 7. テスト要件

### 7.1 単体テスト（将来実装）
- 推薦スコア計算のテスト
- フィルタリング機能のテスト
- プロファイル判定のテスト

### 7.2 統合テスト（将来実装）
- APIエンドポイントのテスト
- フロントエンド・バックエンド連携テスト

### 7.3 ユーザーテスト
- ハイブリッド診断の使いやすさ
- 検索結果の精度
- UI/UXの評価

---

## 8. 運用要件

### 8.1 デプロイ環境
- 開発環境: ローカル（Flask開発サーバー）
- 本番環境: 未定（将来はクラウドサービス利用予定）

### 8.2 データ更新
- 手動によるCSVファイル更新

### 8.3 ログ管理
- エラーログの記録
- アクセスログの記録（将来実装）

---

## 9. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|-----------|---------|--------|
| 2025-01-XX | 1.0 | 初版作成 | - |

---

## 10. 参考資料

- README.md: プロジェクトの概要とセットアップ手順
- ソースコード: 各モジュールの実装詳細

---

**文書作成日**: 2025年1月
**最終更新日**: 2025年12月20日
**バージョン**: 1.1